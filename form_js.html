<script>
  window.clearIt = function(thisEl) {
    document.getElementById('msgToUsr').style.display = 'none';
  };
  
  window.submitForm = function(myForm) {
    var key,value,requiredList=[],nameName,thisEl,errElmt,inputType,die;
    die = false;

    requiredList = ['name', 'address', 'phone', 'study', 'faculty', 'year', 'gpa', 'position', 'myFile1'];

    for (key in myForm) {
    
      thisEl = myForm[key];
      if (thisEl===null) continue;
      
      nameName = thisEl.name;
      if (requiredList.indexOf(nameName) === -1) {continue;};
      
      value = thisEl.value;
      inputType = thisEl.type;
      
      if (value === "") {      
        if (requiredList.indexOf(nameName) === -1) {continue;};
        die = true;
        toggle_visibility('inProgress');
        toggle_visibility('formDiv');        
        thisEl.style.background = 'linear-gradient(to right, #efefbb, #d4d3dd)';
        thisEl.focus();
        window.scrollTo(0,0);
        errElmt = document.getElementById('msgToUsr');
        errElmt.textContent = "Terjadi Error dalam Unggahan. Silakan Lengkapi Data.";
        errElmt.style.display = 'inline';
        errElmt.addEventListener("click", function(){
           this.style.display = "none";});
      };
    };
    
    if (die) return; 
    toggle_visibility('formDiv');
    toggle_visibility('inProgress');
    spinner_shwSpnr('idSpnr');    
    google.script.run
      .withSuccessHandler(updateOutput)
      .processForm(myForm)  
  };

  function updateOutput(dataReturned) {
    var html,outputDiv;
    if (typeof dataReturned === 'object') {
      html = '<div class="notification is-danger" style="text-align: center;" role="alert"><h2>Data belum diunggah. File Spreadsheet belum siap. Coba lagi nanti! Terima kasih.</h2></div><br>';
    } else {
      html = '<div class="notification is-success" style="text-align: center;" role="alert"><h2>Data Anda telah berhasil diunggah. Silakan cek twitter kami untuk tahap selanjutnya. Terima kasih.</h2></div><br>';
    };
    toggle_visibility('inProgress');
    outputDiv = document.getElementById('output');
    outputDiv.innerHTML = html + dataReturned;
    spinner_hideSpnr('idSpnr');
  }

  function toggle_visibility(id) {
    var e;
    e = document.getElementById(id);
    if(e.style.display !== 'none')
      e.style.display = 'none';
    else
      e.style.display = 'block';
  }
  
</script>
